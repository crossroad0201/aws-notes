Lambda
====

# 全般

* スピンアップに時間がかかる。
  * JVM系のランタイムでは長くかかる。
  * VPCに入っていると、IPアドレスの割当てなどにさらに時間がかかる。
  * 必要であれば、Lambaインスタンスが停止しないように定期的に呼び出す必要がある。
    * Lambdaを扱うフレームワークの中には、設定するだけで *CLoudWatch* から定期的に呼び出す仕組みを持っているものがある。

* 最大5分しか処理できない。
  * ひとつのLambda関数単独ではバッチ処理のような時間のかかる処理は実装できない。
  * *Step Functions* と組み合わせるなど。

* メモリ割り当て量に応じて、Lambda関数が実行されるマシンのスペックが上がる。
  * [Q: コンピューティングリソースはどのように AWS Lambda に割り当てられるのですか?](https://aws.amazon.com/jp/lambda/faqs/)
  * ただし、メモリ割り当てを大きくすると、1台のマシン(実体はEC2らしい)上で実行されるLambdaインスタンスの数も少なくなり、
    新しいLambaインスタンスが起動するときにすでに稼働しているマシン上でではなく、新しいマシンが起動する確立が高くなり、スピンアップの時間も長くなる傾向になる。

* ひとつのLambda関数で、バージョンとエイリアスによって環境（本番環境とテスト環境など）の違いを扱うのは運用しづらい。
  * 環境変数、タグは `$LATEST` でしか変更できない。

* Lambda関数の [同時実行数には制限](https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/concurrent-executions.html#concurrent-execution-safety-limit) がある。
  * *CloudWatch* の *Lambda/ConcurrentExecution* メトリクスを監視し、必要であれば制限緩和を申請する必要がある。

# コスト

* 実行回数に対する従量課金で、Lambda関数を作成しておくだけならコストはかからない。

* 向上的にある程度のトランザクションが発生するような用途であれば、Lambdaよりサーバ（EC2やECSなど）を使うほうがコスト安になる場合がある。

# Javaランタイム

* プラットフォームデフォルトのタイムゾーンは `UTC` だが、まれに異なるタイムゾーン（`GMT`など）に変わることがあるため、実行時のタイムゾーンを明示的に指定しておくほうが安全。
タイムゾーンを確実に `UTC` にするには、環境変数 `TZ` で`UTC` を指定する。
